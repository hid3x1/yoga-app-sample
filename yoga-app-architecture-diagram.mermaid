flowchart TB
    subgraph クライアント側
        direction TB
        UI[ユーザーインターフェース]
        CameraM[カメラモジュール]
        PoseD[姿勢検出エンジン\nMediaPipe/BlazePose]
        PoseA[姿勢分析エンジン]
        LocalDB[(ローカルDB)]
        AuthM[認証モジュール]
        
        UI --> CameraM
        CameraM --> PoseD
        PoseD --> PoseA
        PoseA --> UI
        UI <--> LocalDB
        UI <--> AuthM
    end
    
    subgraph サーバー側
        direction TB
        API[API サービス]
        AuthS[認証サービス]
        UserDB[(ユーザーDB)]
        PoseDB[(ポーズDB)]
        LessonDB[(レッスンDB)]
        Analytics[分析サービス]
        
        API --> AuthS
        API <--> UserDB
        API <--> PoseDB
        API <--> LessonDB
        API <--> Analytics
    end
    
    %% クライアントとサーバーの接続
    AuthM <--> AuthS
    UI <--> API
    
    %% オフライン動作モード
    LocalDB -.-> |オフラインモード| UI
    
    %% データフロー
    CameraM --> |ビデオフレーム| PoseD
    PoseD --> |キーポイント| PoseA
    PoseA --> |スコア/フィードバック| UI
    
    %% バックエンドとの同期
    LocalDB <-.-> |同期| API
